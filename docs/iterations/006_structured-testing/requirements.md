# Итерация 006: Structured Testing — Requirements

**Статус:** В работе
**Дедлайн:** Середина марта 2026

---

## Модель: «Инструктор управляет — курсант выполняет»

- Инструктор назначает группе блоки и модули
- Курсант видит только назначенные тесты
- Инструктор открывает и закрывает доступ к модулям
- Инструктор анализирует результаты и принимает решения о продвижении

---

## Структура курса

### Блоки и модули

4 блока, 20 модулей. Каждый модуль состоит из 3 параграфов:

| Параграф | Тип | Описание |
|----------|-----|----------|
| §1 | Теория | Лекционный материал (вне приложения) |
| §2 | Самопроверка | Тестовые вопросы для самостоятельной проверки |
| §3 | Практический экзамен | Оценочное тестирование (оценивается инструктором) |

Параграфы 2 и 3 — основные для электронной рабочей тетради.

### Маппинг модулей → компетенции

Определён в `js/competencies-config.js` (`MODULE_TO_COMPETENCY`):

| Модуль | Компетенция | Блок |
|--------|------------|------|
| 1 | Фармакологические основы | BASICS |
| 2 | Антибактериальная терапия | PHARMACOLOGY |
| 3 | Антигистаминные препараты | PHARMACOLOGY |
| 4 | Глазные и ушные инфекции | INFECTIONS |
| 5 | ОРВИ | INFECTIONS |
| 6 | НПВС | PHARMACOLOGY |
| 7 | Глюкокортикостероиды | PHARMACOLOGY |
| 8 | Адреналин | PHARMACOLOGY |
| 9 | Спазмолитики | PHARMACOLOGY |
| 10 | Геморрагический шок | SHOCK |
| 11 | Инфузионная терапия | PHARMACOLOGY |
| 12 | Антидоты | PHARMACOLOGY |
| 13 | Анальгезия | PHARMACOLOGY |
| 14 | Септический шок | SHOCK |
| 15 | Клещевые инфекции | INFECTIONS |
| 16 | Бешенство | INFECTIONS |
| 17 | Инфаркт и инсульт | EMERGENCY |
| 18 | Детоксикация | EMERGENCY |
| 19 | Огнестрельные раны | TRAUMA |
| 20 | Ожоги | TRAUMA |

---

## Уровни (курсы)

| Уровень | Описание |
|---------|----------|
| Базовый | Основы фармакологии |
| Боец-спасатель | Тактическая медицина |
| Фармакология | Продвинутый курс |

---

## Типы заданий

| Тип | Количество | Статус |
|-----|-----------|--------|
| Multiple choice | 88 существующих | Работает |
| Open-ended | Расчёты, объяснения | Планируется |
| Clinical scenarios | OSCE-like, интерактивные | Future |

---

## Workflow курсанта

```
Регистрация → привязка к группе
    → Входной тест (инструктор открывает)
    → Блок I → Модуль 1 → Параграф 2 (самопроверка) → Параграф 3 (экзамен)
    → Инструктор анализирует результаты
        → Открывает следующий модуль
        → Или назначает повтор
    → ... (все модули блока)
    → Финальный экзамен
```

---

## Новые таблицы (планируемые)

### `course_assignments`
Какие модули открыты для какой группы.

| Поле | Тип | Описание |
|------|-----|----------|
| id | UUID | PK |
| group_code | TEXT | FK → groups.code |
| module_number | INTEGER | Номер модуля (1–20) |
| paragraph | INTEGER | Параграф (2 или 3) |
| is_open | BOOLEAN | Доступен ли курсантам |
| opened_by | UUID | FK → auth.users (инструктор) |
| opened_at | TIMESTAMPTZ | Когда открыт |

### `test_sessions`
Сессии тестирования: входной, модульный, финальный.

| Поле | Тип | Описание |
|------|-----|----------|
| id | UUID | PK |
| cadet_id | TEXT | FK → cadets.id |
| type | TEXT | 'diagnostic' / 'module' / 'final' |
| module_number | INTEGER | NULL для diagnostic/final |
| paragraph | INTEGER | 2 или 3 |
| score | NUMERIC | Результат (0–100) |
| answers | JSONB | Ответы курсанта |
| started_at | TIMESTAMPTZ | Начало |
| completed_at | TIMESTAMPTZ | Завершение |

### `course_levels`
Уровни курса.

| Поле | Тип | Описание |
|------|-----|----------|
| id | TEXT | PK: 'basic', 'fighter-rescuer', 'pharmacology' |
| name | TEXT | Название уровня |
| modules | INTEGER[] | Номера включённых модулей |

---

## Scope

### 006A: Student-facing structured tests
- Курсант видит только назначенные (открытые) модули
- Навигация: блок → модуль → параграф 2/3
- Отображение результатов по модулям
- Таблица `course_assignments` для visibility

### 006B: Instructor tools
- Открытие/закрытие модулей для группы
- Mass-привязка вопросов к модулям (question.module)
- Просмотр результатов по группам и курсантам
- Таблица `test_sessions` для результатов

### 006C: Analytics (roadmap item)
- Отчёты по группам: средний балл, прогресс
- Отчёты по курсантам: детализация по модулям
- Экспорт результатов
