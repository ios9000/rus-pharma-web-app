# Итерация 006 — Управляемое структурированное тестирование: Требования

> Дата: 2026-02-11
> Статус: Проектирование

---

## 1. Цель

Перейти от «все 88 вопросов валом» к структурированному тестированию, управляемому инструктором. Курсант видит только назначенные ему блоки/модули. Инструктор управляет темпом, последовательностью и типами заданий.

---

## 2. Модель управления

**Военная модель: «Инструктор управляет — курсант выполняет»**

Курсант НЕ выбирает, что проходить. Инструктор:
- Открывает/закрывает блоки и модули для группы
- Назначает тесты (входной, по модулю, финальный)
- Может назначить повторное прохождение
- Управляет темпом и последовательностью обучения

Курсант видит ТОЛЬКО то, что назначено инструктором.

---

## 3. Пользовательские сценарии

### UC-1: Инструктор создаёт группу и назначает курс
1. Инструктор авторизуется в кабинете
2. Создаёт группу: «Фармакология-2025», уровень 3
3. Видит полный список блоков и модулей курса
4. Открывает Блок I (модули 1–6) для группы
5. Остальные блоки остаются закрытыми

### UC-2: Инструктор назначает входное тестирование
1. Инструктор создаёт тестовую сессию типа «входное тестирование»
2. Выбирает блоки/модули, по которым проводится срез
3. Система формирует набор вопросов из выбранных модулей
4. Курсанты группы видят назначенный тест

### UC-3: Курсант проходит модульный тест
1. Курсант авторизуется (или идентифицируется по группе)
2. Видит только назначенные модули с индикацией статуса (новый / в процессе / завершён)
3. Открывает модуль → видит:
   - Параграф 2: Тесты multiple choice + задания с развёрнутым ответом
   - Параграф 3: Интерактивный клинический сценарий (если привязан)
4. Проходит тест, ответы сохраняются
5. Видит результат по модулю (не по всему курсу)

### UC-4: Инструктор назначает повторное прохождение
1. Инструктор видит статус прохождения по группе
2. Видит результаты конкретного курсанта по модулю
3. Нажимает «Назначить повторное прохождение»
4. Курсант видит модуль как «назначен повторно»

### UC-5: Курсант отвечает на задание с развёрнутым ответом
1. Курсант видит вопрос с полем для свободного ввода (textarea)
2. Вопрос может содержать: формулу, исходные данные, структуру ответа (поля для заполнения)
3. Курсант вводит ответ
4. Система сохраняет ответ (автоматическая проверка НЕ нужна на данном этапе)
5. Инструктор может позже просмотреть ответы курсантов

### UC-6: Инструктор открывает следующий модуль
1. Группа завершила модуль 1
2. Инструктор видит статус и решает открыть модуль 2
3. Нажимает «Открыть модуль 2» для группы
4. Курсанты видят новый доступный модуль

---

## 4. Уровневая модель курсов

Три уровня:

| Уровень | Название | Описание |
|---------|----------|----------|
| 1 | Базовый курс тактической медицины | TCCC (MARCH + PAWS) |
| 2 | Боец-спасатель | Тактический акцент |
| 3 | Фармакология и обработка ран | Углублённый курс |

Принципы:
- Курсант растёт по уровням (1 → 2 → 3), но может прийти сразу на конкретный уровень
- Прогресс сохраняется при переходе между уровнями
- Инструктор решает, что назначить
- Уровни 1 и 2 могут объединиться в будущем
- Элементы фармакологии присутствуют на всех уровнях

Идентификаторы групп уже содержат уровень: «Базовый курс-2025», «Боец-спасатель-2025», «Фармакология-2025»

---

## 5. Структура курса

### Иерархия: Блоки → Модули → Компетенции

**БЛОК I: Фармакологические основы** — Модули 1–6
- Модуль 1: Фармакологические основы (ADME, дозировки)
- Модуль 2: Антибактериальная терапия
- Модуль 3: Антигистаминные препараты
- Модуль 4: Глазные и ушные инфекции
- Модуль 5: Вирусные инфекции (ОРВИ)
- Модуль 6: НПВС

**БЛОК II: Специальные препараты и критические состояния** — Модули 7–13, 21
- Модуль 7: Глюкокортикостероиды
- Модуль 8: Адреналин
- Модуль 9: Спазмолитики
- Модуль 10: Шок
- Модуль 11: Инфузионная терапия
- Модуль 12: Антидоты
- Модуль 13: Анальгезия
- Модуль 21: (дополнительный)

**БЛОК III: Неотложные состояния** — Модули 14–18
- Модуль 14: Септический шок
- Модуль 15: Клещевые инфекции
- Модуль 16: Бешенство
- Модуль 17: Инфаркт и инсульт
- Модуль 18: Детоксикация

**БЛОК IV: Боевая травма** — Модули 19–20
- Модуль 19: Огнестрельные раны
- Модуль 20: Ожоги

---

## 6. Типы заданий

### 6.1 Multiple choice (существующий)
- Уже реализован в таблице `questions`
- Нужна группировка по модулям (поле `module` заполнено частично)
- Фильтрация по назначенным инструктором модулям

### 6.2 Задания с развёрнутым ответом (НОВЫЙ тип)
Типы:
- Объяснение причин (перечисление 3+ пунктов)
- Расчёт дозировок по формуле
- Расчёт объёмов инфузии
- Составление схем отмены препаратов
- Перечисление опасных комбинаций с указанием эффектов

Формат вопроса:
- Текст задания (может содержать исходные данные, формулу)
- Структура ответа: набор полей для заполнения (label + textarea)
- Эталонный ответ (видит только инструктор)

На данном этапе: **автоматическая проверка НЕ нужна**. Курсант вводит ответ, инструктор проверяет вручную (или не проверяет — задания для самоконтроля).

### 6.3 Интерактивные клинические сценарии (существующий)
- Уже реализовано в приложении
- Нужна привязка к модулям
- Отображается как Параграф 3 модуля

---

## 7. Структура тестирования по модулю

Каждый модуль содержит 3 параграфа:
1. **Параграф 1:** Справочно-теоретические слайды (справочный материал) — вне scope 006
2. **Параграф 2:** Рабочая тетрадь для самоконтроля ⭐
   - Слайд 2.1: Тесты multiple choice
   - Задания с развёрнутым ответом / расчётные задачи
3. **Параграф 3:** Практический экзамен ⭐ → интерактивные клинические сценарии

---

## 8. Тестовые блоки курса

| Тип | Назначение | Когда |
|-----|-----------|-------|
| Входное тестирование | Срез знаний по всем блокам | В начале курса |
| Модульный тест | По конкретному модулю | По мере прохождения |
| Финальный экзамен | Итоговый по всему курсу | В конце курса |

Все три типа назначает инструктор.

---

## 9. Scope итерации 006

### 006A — Структурированное тестирование (сторона курсанта)
- [ ] Курсант видит только назначенные инструктором блоки/модули
- [ ] Тесты сгруппированы по модулям (не все вопросы валом)
- [ ] Поддержка входного / модульного / финального тестирования
- [ ] Новый тип задания: развёрнутый ответ (расчётные задачи)
- [ ] Прогресс по модулям (не по всему курсу сразу)
- [ ] Интерактивные сценарии привязаны к модулям

### 006B — Инструменты инструктора: управление тестами
- [ ] Панель управления курсом: список блоков/модулей, кнопки открыть/закрыть
- [ ] Создание/управление группами курсантов
- [ ] Привязка вопросов к модулям (UI для массового редактирования)
- [ ] Создание тестовых сессий (входной, по модулю, финальный)
- [ ] Назначение повторного прохождения
- [ ] Просмотр статуса прохождения курсантов

---

## 10. Что НЕ входит в итерацию 006

- 006C: Аналитика и отчётность (статистика, рекомендации инструктору)
- Параллельные группы с разными программами
- Автоматические подсказки инструктору «когда открыть следующий модуль»
- Автоматическая проверка развёрнутых ответов (LLM grading)
- Параграф 1 (справочные слайды) — контент есть, но интеграция в приложение отложена
- Полная миграция данных из Google Sheets в Supabase (отдельная итерация)

---

## 11. Данные: текущее состояние (по результатам аудита)

### Источники данных
- **Google Sheets** (основной): 81 вопрос MC, карточки препаратов, сценарии, группы, курсанты, прогресс
- **Supabase** (дополнительный): 7 вопросов MC [SB], generated_content, generation_logs

### Вопросы: маппинг по модулям
- **81 из 88** вопросов уже имеют числовой модуль (1–20) — маппинг тривиальный
- **7 вопросов [SB]** — все относятся к Модулю 1 (PHARMACOLOGY_BASICS)
- Связь Модуль ↔ Компетенция — строго **1:1**

### Существующая система групп/курсантов (Google Sheets)
```
Лист «Группы»:   group_code, group_name, instructor, is_active, max_cadets
Лист «Курсанты»: cadet_id, group_code, full_name, pin_code, is_active
Лист «Прогресс»: cadet_id, data_type, data_key, data_value (JSON)
```
Группа: PHARMA-0126 | 2 курсанта | PIN-авторизация

### Существующие поля в таблице questions (Supabase)
- `competencies` / `competency_id` — привязка к компетенции
- `competency_block` — блок компетенции
- `section` — раздел (числовой 1–5 или BASICS)
- `module` — модуль (числовой 1–20, текстовый или пустой для [SB])
- `difficulty` — сложность (1–2, нет сложности 3 в текущих данных)

### Стратегия работы с данными в 006
- Работаем с двумя источниками параллельно (GSheets + Supabase)
- Новые таблицы (course_modules, assignments, sessions, results) — в Supabase
- Вопросы MC — загружаются из обоих источников, фильтруются по модулю на клиенте
- Полная миграция GSheets → Supabase — **отдельная будущая итерация**

---

## 12. Нефункциональные требования

- **Offline:** Тестирование работает при наличии загруженных данных (Service Worker cache)
- **Производительность:** Переключение модулей < 500 мс
- **Совместимость:** Работает на мобильных устройствах (полевые условия)
- **Обратная совместимость:** Существующая функциональность (flashcards, сценарии, карточки препаратов) не ломается
- **Google Sheets sync:** Синхронизация продолжает работать (не ломаем Apps Script)

---

## 13. Критерии приёмки

- [ ] Инструктор может создать группу и назначить уровень курса
- [ ] Инструктор может открыть/закрыть конкретные модули для группы
- [ ] Инструктор может создать тестовую сессию (входной/модульный/финальный)
- [ ] Курсант видит ТОЛЬКО назначенные модули
- [ ] Вопросы сгруппированы по модулям (не валом)
- [ ] Задания с развёрнутым ответом работают (ввод + сохранение)
- [ ] Прогресс отображается по модулям
- [ ] Инструктор видит статус прохождения курсантов
- [ ] Существующая функциональность не нарушена
